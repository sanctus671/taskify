"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2804],{2804:function(L,M,f){f.r(M),f.d(M,{QuestsPageModule:function(){return H}});var q=f(3144),Z=f(5671),C=f(9808),O=f(4182),u=f(4881),P=f(1e3),h=f(7762),t=f(8433),y=f(7020),Q=f(622),x=f(4303),T=function(){return["/add-quest"]};function b(n,i){1&n&&(t.TgZ(0,"div",11),t.TgZ(1,"ion-button",12),t._uU(2," Create New "),t.qZA(),t.qZA()),2&n&&(t.xp6(1),t.Q6J("routerLink",t.DdM(1,T)))}function A(n,i){1&n&&(t.TgZ(0,"div",13),t._UZ(1,"ion-progress-bar",14),t.qZA())}function S(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1,"Claim"),t.qZA())}function J(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1,"In Progress"),t.qZA())}function U(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1,"Claimed"),t.qZA())}function Y(n,i){if(1&n){var s=t.EpF();t.TgZ(0,"ion-button",19),t.NdJ("click",function(){t.CHM(s);var r=t.oxw().$implicit;return t.oxw().claim(r)}),t.YNc(1,S,2,0,"span",10),t.YNc(2,J,2,0,"span",10),t.YNc(3,U,2,0,"span",10),t.qZA()}if(2&n){var e=t.oxw().$implicit;t.Q6J("disabled","inprogress"===e.status||"claimed"===e.status),t.xp6(1),t.Q6J("ngIf","open"===e.status),t.xp6(1),t.Q6J("ngIf","inprogress"===e.status),t.xp6(1),t.Q6J("ngIf","claimed"===e.status)}}var k=function(i){return[i]};function w(n,i){if(1&n&&(t.TgZ(0,"a",20),t._UZ(1,"ion-icon",21),t.qZA()),2&n){var s=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(1,k,"/edit-quest/"+s.id))}}var I=function(i){return{"quests__list__item--disabled":i}};function F(n,i){if(1&n&&(t.TgZ(0,"div",15),t.TgZ(1,"h6"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"h4"),t._uU(6),t.qZA(),t.TgZ(7,"div",16),t.YNc(8,Y,4,4,"ion-button",17),t.qZA(),t.YNc(9,w,2,3,"a",18),t.qZA()),2&n){var s=i.$implicit,e=t.oxw();t.Q6J("ngClass",t.VKq(6,I,"inprogress"===s.status||"claimed"===s.status)),t.xp6(2),t.Oqu(s.name),t.xp6(2),t.Oqu(s.description),t.xp6(2),t.hij("",s.reward," Coin reward"),t.xp6(2),t.Q6J("ngIf",("gamemaster"!==e.userType||e.gameMasterJoined)&&s.status),t.xp6(1),t.Q6J("ngIf","gamemaster"===e.userType)}}function N(n,i){if(1&n){var s=t.EpF();t.TgZ(0,"ion-button",24),t.NdJ("click",function(){t.CHM(s);var o=t.oxw().$implicit;return t.oxw(2).completeQuest(o)}),t._UZ(1,"ion-icon",25),t._uU(2," Complete "),t.qZA()}}function D(n,i){if(1&n&&(t.TgZ(0,"ion-item"),t.TgZ(1,"ion-label"),t.TgZ(2,"h4"),t._uU(3),t.qZA(),t.TgZ(4,"h5"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA(),t.qZA(),t.YNc(8,N,3,0,"ion-button",23),t.qZA()),2&n){var s=i.$implicit,e=t.oxw(2);t.xp6(3),t.Oqu(s.quest.name),t.xp6(2),t.Oqu(s.status),t.xp6(2),t.hij("",s.quest.reward," Coins"),t.xp6(1),t.Q6J("ngIf","gamemaster"===e.userType&&"claimed"!==s.status)}}function z(n,i){if(1&n&&(t.TgZ(0,"ion-list"),t.TgZ(1,"ion-list-header"),t._uU(2,"Squad Claimed Quests"),t.qZA(),t.YNc(3,D,9,4,"ion-item",22),t.qZA()),2&n){var s=t.oxw();t.xp6(3),t.Q6J("ngForOf",s.squadClaimedQuests)}}var j=[{path:"",component:function(){var n=function(){function i(s,e,o,r,a){var c=this;(0,Z.Z)(this,i),this.alertCtrl=s,this.authenticationService=e,this.playerService=o,this.loadingController=r,this.questService=a,this.quests=[],this.user={},this.players=[],this.squad={},this.managedProfiles=[],this.squadClaimedQuests=[],this.loading=!0,this.authenticationService.getUserData().subscribe(function(l){l&&(c.user=l,c.getJoinedSquad())})}return(0,q.Z)(i,[{key:"ngOnInit",value:function(){}},{key:"getQuests",value:function(){var e=this;this.questService.getQuests(this.squad.id).then(function(o){e.loading=!1,e.quests=o,e.getPlayers()}).catch(function(){e.loading=!1}),this.questService.getSquadClaimedQuests(this.squad.id).then(function(o){e.squadClaimedQuests=o}).catch(function(){})}},{key:"getPlayers",value:function(){var e=this;this.playerService.getPlayers(this.squad.id).then(function(o){e.players=o,e.managedProfiles=[];var a,r=(0,h.Z)(e.players);try{for(r.s();!(a=r.n()).done;){var m,c=a.value,l=(0,h.Z)(e.quests);try{for(l.s();!(m=l.n()).done;){var d=m.value;d.status||(d.status="open");var g,p=(0,h.Z)(c.quests);try{for(p.s();!(g=p.n()).done;){var _=g.value;if(d.id===_.quest_id){c.profile.user_id===e.user.id&&"inprogress"===_.status||"inprogress"===_.status&&!d.recurring?d.status="inprogress":!d.recurring&&"claimed"===_.status&&(d.status="claimed");break}}}catch(v){p.e(v)}finally{p.f()}}}catch(v){l.e(v)}finally{l.f()}c.profile.user_id===e.user.id&&e.managedProfiles.push(c)}}catch(v){r.e(v)}finally{r.f()}})}},{key:"claim",value:function(e){var o=this;if(this.managedProfiles.length>1||"gamemaster"===this.userType){var c,r=[],a=(0,h.Z)(this.managedProfiles);try{for(a.s();!(c=a.n()).done;){var l=c.value;r.push({name:"player",type:"radio",label:l.profile.name,value:l.id})}}catch(g){a.e(g)}finally{a.f()}r.push({name:"player",type:"radio",label:"Claim for squad total",value:"squadtotal"}),this.alertCtrl.create({header:"Select Player",message:"You manage multiple players. Select the player you want to claim this quest for.",inputs:r,buttons:[{text:"Cancel",role:"cancel",handler:function(_){}},{text:"Claim",handler:function(_){_&&setTimeout("squadtotal"===_?function(){o.claimQuest(e,0,!0)}:function(){o.claimQuest(e,parseInt(_),!1)},200)}}]}).then(function(g){g.present()})}else{var d=[];d.push({name:"player",type:"radio",label:"Claim for myself",value:this.managedProfiles[0].id}),d.push({name:"player",type:"radio",label:"Claim for squad total",value:"squadtotal"}),this.alertCtrl.create({header:"Confirm",message:"Choose who you want to receive the coins from this quest.",inputs:d,buttons:[{text:"Cancel",role:"cancel",handler:function(_){}},{text:"Claim",handler:function(_){_&&setTimeout("squadtotal"===_?function(){o.claimQuest(e,0,!0)}:function(){o.claimQuest(e,parseInt(_),!1)},200)}}]}).then(function(g){g.present()})}}},{key:"claimQuest",value:function(e,o,r){var a=this;r?this.questService.claimQuestSquad(e.id,this.squad.id).then(function(){a.authenticationService.retreiveUserData(),a.alertCtrl.create({header:"Success",message:"You have successfully claimed this quest. It is now in progress.",buttons:[{text:"Dismiss",role:"cancel",handler:function(m){}}]}).then(function(l){l.present()})}):this.questService.claimQuest(e.id,o).then(function(){a.authenticationService.retreiveUserData(),a.alertCtrl.create({header:"Success",message:"You have successfully claimed this quest. It is now in progress.",buttons:[{text:"Dismiss",role:"cancel",handler:function(m){}}]}).then(function(l){l.present()})})}},{key:"getJoinedSquad",value:function(){var e=this;this.authenticationService.getJoinedSquad().then(function(o){if(o){var r=parseInt(o);if(e.squad.id!==r){e.squad.id=r;var c,a=(0,h.Z)(e.user.squads);try{for(a.s();!(c=a.n()).done;)if(c.value.id===r){e.userType="gamemaster";break}}catch(g){a.e(g)}finally{a.f()}if("gamemaster"===e.userType){var d,m=(0,h.Z)(e.user.joined_squads);try{for(m.s();!(d=m.n()).done;)d.value.id===r&&(e.gameMasterJoined=!0)}catch(g){m.e(g)}finally{m.f()}}}e.getQuests()}})}},{key:"completeQuest",value:function(e){var o=this;this.alertCtrl.create({header:"Confirm",message:"You are about to complete this quest. Once completed, the squad will receive the coins.",buttons:[{text:"Cancel",role:"cancel",handler:function(c){}},{text:"Complete",handler:function(c){e.status="claimed",o.questService.updatePlayerQuest(e).then(function(){o.authenticationService.retreiveUserData()})}}]}).then(function(a){a.present()})}}]),i}();return n.\u0275fac=function(s){return new(s||n)(t.Y36(u.Br),t.Y36(y.$),t.Y36(Q.l),t.Y36(u.HT),t.Y36(x.T))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-quests"]],decls:15,vars:4,consts:[["translucent","true","mode","ios"],["mode","md"],["slot","start"],["fullscreen","true",1,"quests"],["mode","ios"],["size","large"],["class","quests__add",4,"ngIf"],["class","quests__loading",4,"ngIf"],[1,"quests__list"],["class","quests__list__item",3,"ngClass",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"quests__add"],["color","secondary","shape","round","routerDirection","forward",3,"routerLink"],[1,"quests__loading"],["type","indeterminate","color","primary"],[1,"quests__list__item",3,"ngClass"],[1,"quests__list__item__actions"],["color","tertiary","shape","round","size","small",3,"disabled","click",4,"ngIf"],["class","rewards__list__item__edit","routerDirection","forward",3,"routerLink",4,"ngIf"],["color","tertiary","shape","round","size","small",3,"disabled","click"],["routerDirection","forward",1,"rewards__list__item__edit",3,"routerLink"],["slot","icon-only","name","create"],[4,"ngFor","ngForOf"],["color","secondary","slot","end",3,"click",4,"ngIf"],["color","secondary","slot","end",3,"click"],["name","checkmark-circle-outline","slot","start"]],template:function(s,e){1&s&&(t.TgZ(0,"ion-header",0),t.TgZ(1,"ion-toolbar",1),t._UZ(2,"ion-title"),t.TgZ(3,"ion-buttons",2),t._UZ(4,"ion-back-button"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(5,"ion-content",3),t.TgZ(6,"ion-header",4),t.TgZ(7,"ion-toolbar"),t.TgZ(8,"ion-title",5),t._uU(9,"Quests"),t.qZA(),t.qZA(),t.qZA(),t.YNc(10,b,3,2,"div",6),t.YNc(11,A,2,0,"div",7),t.TgZ(12,"div",8),t.YNc(13,F,10,8,"div",9),t.qZA(),t.YNc(14,z,4,1,"ion-list",10),t.qZA()),2&s&&(t.xp6(10),t.Q6J("ngIf","gamemaster"===e.userType),t.xp6(1),t.Q6J("ngIf",e.loading),t.xp6(2),t.Q6J("ngForOf",e.quests),t.xp6(1),t.Q6J("ngIf",e.squadClaimedQuests.length>0))},directives:[u.Gu,u.sr,u.wd,u.Sm,u.oU,u.cs,u.W2,C.O5,C.sg,u.YG,u.YI,P.rH,u.X7,C.mk,u.Fo,P.yS,u.gu,u.q_,u.yh,u.Ie,u.Q$],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--border-color:transparent}.quests[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #000000}.quests[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{position:static}.quests[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   .toolbar-title[_ngcontent-%COMP%]{overflow:visible;white-space:normal}.quests[_ngcontent-%COMP%]   .quests__loading[_ngcontent-%COMP%]{padding:40px 20px 0}.quests[_ngcontent-%COMP%]   .quests__add[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:5px;padding:0 15px}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]{padding:0 15px;margin-top:30px}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]{position:relative;background:#0FF0FC;border-radius:35px;color:#000;padding:45px;margin-top:15px}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0 0 5px;color:#000;font-weight:700}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#000}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:10px 0 0;color:#ff6700}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]   .quests__list__item__actions[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]   .rewards__list__item__edit[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:15px;color:#000}.quests[_ngcontent-%COMP%]   .quests__list[_ngcontent-%COMP%]   .quests__list__item[_ngcontent-%COMP%]   .rewards__list__item__edit[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:26px}.quests[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{margin-top:40px}.quests[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{font-size:18px;font-weight:700}.quests[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#f9d700}"]}),n}()}],B=function(){var n=(0,q.Z)(function i(){(0,Z.Z)(this,i)});return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[P.Bz.forChild(j)],P.Bz]}),n}(),H=function(){var n=(0,q.Z)(function i(){(0,Z.Z)(this,i)});return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[C.ez,O.u5,u.Pc,B]]}),n}()}}]);