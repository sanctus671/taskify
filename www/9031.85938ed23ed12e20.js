"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9031],{9031:function(j,M,f){f.r(M),f.d(M,{RewardsPageModule:function(){return $}});var C=f(3144),Z=f(5671),P=f(9808),O=f(4182),o=f(4881),w=f(1e3),v=f(7762),e=f(8433),x=f(7020),y=f(622),T=f(5670);function q(n,r){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"strong"),e._uU(2),e.qZA(),e._uU(3," Coins Available "),e.qZA()),2&n){var a=e.oxw();e.xp6(2),e.Oqu(a.user.total_coins?a.user.total_coins:0)}}var R=function(){return["/add-reward"]};function b(n,r){1&n&&(e.TgZ(0,"div",13),e.TgZ(1,"ion-button",14),e._uU(2," Create New "),e.qZA(),e.qZA()),2&n&&(e.xp6(1),e.Q6J("routerLink",e.DdM(1,R)))}function A(n,r){1&n&&(e.TgZ(0,"div",15),e._UZ(1,"ion-progress-bar",16),e.qZA())}function S(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1,"Purchase"),e.qZA())}function J(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1,"Pending"),e.qZA())}function Y(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1,"Purchased"),e.qZA())}function U(n,r){if(1&n){var a=e.EpF();e.TgZ(0,"ion-button",21),e.NdJ("click",function(){e.CHM(a);var c=e.oxw().$implicit;return e.oxw().purchase(c)}),e.YNc(1,S,2,0,"span",11),e.YNc(2,J,2,0,"span",11),e.YNc(3,Y,2,0,"span",11),e.qZA()}if(2&n){var t=e.oxw().$implicit;e.Q6J("disabled","pending"===t.status||"purchased"===t.status),e.xp6(1),e.Q6J("ngIf","open"===t.status),e.xp6(1),e.Q6J("ngIf","pending"===t.status),e.xp6(1),e.Q6J("ngIf","purchased"===t.status)}}var k=function(r){return[r]};function Q(n,r){if(1&n&&(e.TgZ(0,"a",22),e._UZ(1,"ion-icon",23),e.qZA()),2&n){var a=e.oxw().$implicit;e.Q6J("routerLink",e.VKq(1,k,"/edit-reward/"+a.id))}}var I=function(r){return{"rewards__list__item--disabled":r}};function N(n,r){if(1&n&&(e.TgZ(0,"div",17),e.TgZ(1,"h6"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"h4"),e._uU(6),e.qZA(),e.TgZ(7,"div",18),e.YNc(8,U,4,4,"ion-button",19),e.qZA(),e.YNc(9,Q,2,3,"a",20),e.qZA()),2&n){var a=r.$implicit,t=e.oxw();e.Q6J("ngClass",e.VKq(6,I,"pending"===a.status||"purchased"===a.status)),e.xp6(2),e.Oqu(a.name),e.xp6(2),e.Oqu(a.description),e.xp6(2),e.hij("",a.cost," Coins"),e.xp6(2),e.Q6J("ngIf",("gamemaster"!==t.userType||t.gameMasterJoined)&&a.status),e.xp6(1),e.Q6J("ngIf","gamemaster"===t.userType)}}function F(n,r){if(1&n&&(e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label"),e.TgZ(2,"h4"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.qZA(),e.qZA()),2&n){var a=r.$implicit;e.xp6(3),e.Oqu(a.reward.name),e.xp6(2),e.hij("",a.reward.cost," Coins")}}function D(n,r){if(1&n&&(e.TgZ(0,"ion-list"),e.TgZ(1,"ion-list-header"),e._uU(2,"Squad Purchased Rewards"),e.qZA(),e.YNc(3,F,6,2,"ion-item",24),e.qZA()),2&n){var a=e.oxw();e.xp6(3),e.Q6J("ngForOf",a.squadPurchasedRewards)}}var B=[{path:"",component:function(){var n=function(){function r(a,t,d,c,i){var g=this;(0,Z.Z)(this,r),this.alertCtrl=a,this.authenticationService=t,this.playerService=d,this.loadingController=c,this.rewardService=i,this.user={},this.players=[],this.squad={},this.managedProfiles=[],this.squadTotal=0,this.squadPurchasedRewards=[],this.rewards=[],this.loading=!0,this.authenticationService.getUserData().subscribe(function(u){u&&(g.user=u,g.getJoinedSquad())})}return(0,C.Z)(r,[{key:"ngOnInit",value:function(){}},{key:"getRewards",value:function(){var t=this;this.rewardService.getRewards(this.squad.id).then(function(d){t.loading=!1,t.rewards=d,t.getPlayers()}).catch(function(){t.loading=!1}),this.rewardService.getSquadPurchasedRewards(this.squad.id).then(function(d){t.loading=!1,t.squadPurchasedRewards=d,t.getPlayers()}).catch(function(){t.loading=!1})}},{key:"getPlayers",value:function(){var t=this;this.playerService.getPlayers(this.squad.id).then(function(d){t.players=d,t.managedProfiles=[];var i,c=(0,v.Z)(t.players);try{for(c.s();!(i=c.n()).done;){var p,g=i.value,u=(0,v.Z)(t.rewards);try{for(u.s();!(p=u.n()).done;){var _=p.value;_.status||(_.status="open");var s,l=(0,v.Z)(g.rewards);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(_.id===h.reward_id){g.profile.user_id===t.user.id&&"pending"===h.status||"pending"===h.status&&!_.recurring?_.status="pending":!_.recurring&&"purchased"===h.status&&(_.status="purchased");break}}}catch(m){l.e(m)}finally{l.f()}}}catch(m){u.e(m)}finally{u.f()}g.profile.user_id===t.user.id&&(t.managedProfiles.push(g),t.user.total_coins=g.total_coins)}}catch(m){c.e(m)}finally{c.f()}})}},{key:"purchase",value:function(t){var d=this;if(this.managedProfiles.length>1||"gamemaster"===this.userType){var g,c=[],i=(0,v.Z)(this.managedProfiles);try{for(i.s();!(g=i.n()).done;){var u=g.value;c.push({name:"player",type:"radio",label:u.profile.name,value:u.id})}}catch(l){i.e(l)}finally{i.f()}"gamemaster"===this.userType&&c.push({name:"player",type:"radio",label:"Use squad total",value:"squadtotal"}),this.alertCtrl.create({header:"Select Player",message:"You manage multiple players. Select the player you want to purchase this reward for.",inputs:c,buttons:[{text:"Cancel",role:"cancel",handler:function(s){}},{text:"Purchase",handler:function(s){s&&setTimeout("squadtotal"===s?function(){d.purchaseReward(t,0,!0)}:function(){d.purchaseReward(t,parseInt(s),!1)},200)}}]}).then(function(l){l.present()})}else this.alertCtrl.create({header:"Confirm",message:"Are you sure you want to purchase this reward?",buttons:[{text:"Cancel",role:"cancel",handler:function(s){}},{text:"Yes",handler:function(s){d.purchaseReward(t,d.managedProfiles[0].id,!1)}}]}).then(function(l){l.present()})}},{key:"purchaseReward",value:function(t,d,c){var i=this;if(c){if(this.squadTotal<t.cost)return void this.alertCtrl.create({header:"Error",message:"Your squad does not have enough coins to purchase this reward.",buttons:[{text:"Dismiss",role:"cancel",handler:function(h){}}]}).then(function(s){s.present()});this.rewardService.purchaseRewardSquad(t.id,this.squad.id).then(function(){i.authenticationService.retreiveUserData(),i.alertCtrl.create({header:"Success",message:"You have successfully purchased this reward.",buttons:[{text:"Dismiss",role:"cancel",handler:function(m){}}]}).then(function(h){h.present()})})}else{var p,u=(0,v.Z)(this.players);try{for(u.s();!(p=u.n()).done;){var _=p.value;if(_.id===d){if(_.total_coins<t.cost)return void this.alertCtrl.create({header:"Error",message:"You do not have enough coins to purchase this reward.",buttons:[{text:"Dismiss",role:"cancel",handler:function(h){}}]}).then(function(s){s.present()});break}}}catch(s){u.e(s)}finally{u.f()}this.rewardService.purchaseReward(t.id,d).then(function(){i.authenticationService.retreiveUserData(),i.alertCtrl.create({header:"Success",message:"You have successfully purchased this reward.",buttons:[{text:"Dismiss",role:"cancel",handler:function(m){}}]}).then(function(h){h.present()})})}}},{key:"getJoinedSquad",value:function(){var t=this;this.authenticationService.getJoinedSquad().then(function(d){if(d){var c=parseInt(d);if(t.squad.id!==c){t.squad.id=c;var g,i=(0,v.Z)(t.user.squads);try{for(i.s();!(g=i.n()).done;)if(g.value.id===c){t.userType="gamemaster";break}}catch(s){i.e(s)}finally{i.f()}if("gamemaster"===t.userType){var _,p=(0,v.Z)(t.user.joined_squads);try{for(p.s();!(_=p.n()).done;)_.value.id===c&&(t.gameMasterJoined=!0)}catch(s){p.e(s)}finally{p.f()}}}t.authenticationService.getSquadTotal(t.squad.id).then(function(s){t.squadTotal=s.total}),t.getRewards()}})}}]),r}();return n.\u0275fac=function(a){return new(a||n)(e.Y36(o.Br),e.Y36(x.$),e.Y36(y.l),e.Y36(o.HT),e.Y36(T.x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-rewards"]],decls:16,vars:5,consts:[["translucent","true","mode","ios"],["mode","md"],["slot","start"],["fullscreen","true",1,"rewards"],["mode","ios"],["size","large"],["class","rewards__coins",4,"ngIf"],["class","rewards__add",4,"ngIf"],["class","rewards__loading",4,"ngIf"],[1,"rewards__list"],["class","rewards__list__item",3,"ngClass",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"rewards__coins"],[1,"rewards__add"],["color","secondary","shape","round","routerDirection","forward",3,"routerLink"],[1,"rewards__loading"],["type","indeterminate","color","primary"],[1,"rewards__list__item",3,"ngClass"],[1,"rewards__list__item__actions"],["color","tertiary","shape","round","size","small",3,"disabled","click",4,"ngIf"],["class","rewards__list__item__edit","routerDirection","forward",3,"routerLink",4,"ngIf"],["color","tertiary","shape","round","size","small",3,"disabled","click"],["routerDirection","forward",1,"rewards__list__item__edit",3,"routerLink"],["slot","icon-only","name","create"],[4,"ngFor","ngForOf"]],template:function(a,t){1&a&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e._UZ(2,"ion-title"),e.TgZ(3,"ion-buttons",2),e._UZ(4,"ion-back-button"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(5,"ion-content",3),e.TgZ(6,"ion-header",4),e.TgZ(7,"ion-toolbar"),e.TgZ(8,"ion-title",5),e._uU(9,"Rewards"),e.qZA(),e.YNc(10,q,4,1,"div",6),e.qZA(),e.qZA(),e.YNc(11,b,3,2,"div",7),e.YNc(12,A,2,0,"div",8),e.TgZ(13,"div",9),e.YNc(14,N,10,8,"div",10),e.qZA(),e.YNc(15,D,4,1,"ion-list",11),e.qZA()),2&a&&(e.xp6(10),e.Q6J("ngIf","gamemaster"!==t.userType),e.xp6(1),e.Q6J("ngIf","gamemaster"===t.userType),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(2),e.Q6J("ngForOf",t.rewards),e.xp6(1),e.Q6J("ngIf",t.squadPurchasedRewards.length>0))},directives:[o.Gu,o.sr,o.wd,o.Sm,o.oU,o.cs,o.W2,P.O5,P.sg,o.YG,o.YI,w.rH,o.X7,P.mk,o.Fo,w.yS,o.gu,o.q_,o.yh,o.Ie,o.Q$],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--border-color:transparent}.rewards[_ngcontent-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #000000}.rewards[_ngcontent-%COMP%]   .rewards__loading[_ngcontent-%COMP%]{padding:40px 20px 0}.rewards[_ngcontent-%COMP%]   .rewards__coins[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px}.rewards[_ngcontent-%COMP%]   .rewards__coins[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#f9d700}.rewards[_ngcontent-%COMP%]   .rewards__add[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:5px;padding:0 15px}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]{padding:0 15px;margin-top:30px}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]{position:relative;background:#8A2BE2;background:linear-gradient(90deg,#8A2BE2 0%,#5CE1E6 100%);border-radius:35px;color:#000;padding:45px;margin-top:15px}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0 0 5px;color:#000;font-weight:700}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#000}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:10px 0 0;color:#ff6700}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]   .rewards__list__item__actions[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]   .rewards__list__item__edit[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:15px;color:#000}.rewards[_ngcontent-%COMP%]   .rewards__list[_ngcontent-%COMP%]   .rewards__list__item[_ngcontent-%COMP%]   .rewards__list__item__edit[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:26px}.rewards[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{margin-top:40px}.rewards[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{font-size:18px;font-weight:700}.rewards[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#ff6700}"]}),n}()}],E=function(){var n=(0,C.Z)(function r(){(0,Z.Z)(this,r)});return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[w.Bz.forChild(B)],w.Bz]}),n}(),$=function(){var n=(0,C.Z)(function r(){(0,Z.Z)(this,r)});return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[P.ez,O.u5,o.Pc,E]]}),n}()}}]);